<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××§×•×•×¨×™×•× ×ª×œ×ª ×××“×™ ×¨×™××œ×™×¡×˜×™ ×¢× ×“×’×™×</title>
    <!-- ×¡×’× ×•×Ÿ CSS: ×¨×§×¢, ×§× ×‘×¡ ×•×‘×•×¢×•×ª ×“×™×‘×•×¨ ×œ×“×’×™× --><style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            display: block;
        }
        /* ×‘×•×¢×ª ×“×™×‘×•×¨ ×œ×“×’×™× - ××•×¤×™×¢×” ×œ×™×“ ×”×“×’ ×”××“×‘×¨ */
        .speech-bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.9); /* ×¨×§×¢ ×‘×”×™×¨ */
            border: 3px solid #0077b6; /* ××¡×’×¨×ª ×›×—×•×œ×”-×›×¡×•×¤×” */
            border-radius: 12px;
            padding: 8px 12px;
            font-size: 14px;
            color: #023e8a; /* ×˜×§×¡×˜ ×›×—×•×œ ×›×”×” */
            max-width: 180px;
            text-align: right; /* ×™×™×©×•×¨ ×œ×™××™×Ÿ ×œ×¢×‘×¨×™×ª */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            pointer-events: none;
            z-index: 10;
            transform: translate(-50%, -100%); /* ×××•×§× ××¢×œ ×”× ×§×•×“×” */
            direction: rtl;
        }
        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -12px;
            right: 50%;
            transform: translateX(50%);
            border-width: 12px 12px 0;
            border-style: solid;
            border-color: #0077b6 transparent transparent transparent;
        }
        /* ×‘×•×¢×ª ×”××™×§×•×Ÿ ×©×œ ×”××’×™×© ××¢×œ ×”×“×’ */
        .anchor-icon-bubble {
            position: absolute;
            font-size: 16px;
            background: #ff5e00;
            color: white;
            padding: 2px 6px;
            border-radius: 6px;
            font-weight: bold;
            text-align: center;
            pointer-events: none;
            z-index: 12; /* ** Z-INDEX ×’×‘×•×” ×™×•×ª×¨ ×›×“×™ ×œ×”×™×•×ª ×ª××™×“ ×œ××¢×œ×” ** */
            transform: translate(-50%, -100%); 
            min-width: 60px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            display: none; /* ××•×¡×ª×¨ ×‘×”×ª×—×œ×” */
        }
        
        /* --- ×¡×’× ×•×Ÿ ×ª×¤×¨×™×˜ ×¢×œ×™×•×Ÿ ×§×‘×•×¢ (Top Bar) --- */
        #ui-container {
            position: fixed; 
            top: 10px; 
            left: 10px; 
            height: auto;
            width: auto;
            max-width: 98vw;
            display: flex;
            flex-direction: row; 
            align-items: center;
            z-index: 20;
            padding: 5px; 
            background: #000;
            border: 2px solid #00ffff; 
            box-shadow: 0 0 10px #00ffff55; 
            border-radius: 12px;
            transition: opacity 0.5s ease-in-out; /* ×˜×¨× ×–×™×¦×™×™×ª ×”×¡×ª×¨×” */
            box-sizing: border-box;
            overflow: hidden; 
        }
        
        /* ×”×¡×ª×¨×”/×—×©×™×¤×” ×©×œ ×›×œ ×”×ª×¤×¨×™×˜ (×œ××—×©×‘) */
        #ui-container.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #controls-group {
            display: flex;
            flex-wrap: nowrap; 
            gap: 5px; 
            height: auto;
            margin: 0; 
            padding-right: 5px;
        }
        .icon-button {
            width: 45px; 
            height: 45px;
            padding: 0;
            font-size: 20px; 
            line-height: 45px;
            text-align: center;
            border-radius: 8px; 
            cursor: pointer;
            transition: all 0.2s;
            box-sizing: border-box;
            background: #003366;
            color: white; 
            border: 2px solid #00ffff; 
            box-shadow: 0 0 5px #00ffff55;
            flex-shrink: 0; 
        }
        .icon-button:hover:not(:disabled) {
            background-color: #0055aa;
            transform: scale(1.05);
        }
        .icon-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        #jokesButton, #pauseButton, #apiButton {
            width: 45px;
            height: 45px;
            padding: 0;
            margin: 0 5px; 
            font-size: 20px;
            border-radius: 8px;
            box-sizing: border-box;
            line-height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        #jokesButton {
            background: #225522;
            color: #66BB6A;
            border: 2px solid #66BB6A;
            box-shadow: 0 0 5px #66BB6A55;
        }
        #pauseButton {
            background: #791e1e;
            color: #FFCDD2;
            border: 2px solid #FF5722;
            box-shadow: 0 0 5px #FF572255;
        }
        #apiButton {
            background: #6d4d00;
            color: #FFD700;
            border: 2px solid #FFD700;
            box-shadow: 0 0 5px #FFD70055;
        }

        #statusMessage {
            margin-right: 15px; 
            font-size: 14px;
            color: #00ffff;
            font-weight: 500;
            direction: rtl;
            text-align: right;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis; 
            max-width: 300px;
        }

        /* --- ××•×“××œ API KEY ×—×“×© (××•×¡×ª×¨) --- */
        #api-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
        }
        #api-modal-content {
            background: #111;
            padding: 25px;
            border-radius: 12px;
            border: 3px solid #FFD700;
            box-shadow: 0 0 20px #FFD70055;
            width: 90%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            direction: rtl;
        }
        #api-modal-content input {
            width: 100%;
            padding: 10px;
            margin: 10px 0 15px;
            background: #000;
            border: 1px solid #FFD700;
            color: #00ffff;
            border-radius: 4px;
            box-sizing: border-box;
            text-align: right;
            direction: ltr;
        }
        #api-modal-content button {
            padding: 10px 20px;
            background: #FFD700;
            color: #000;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }
        #api-modal-content button:hover {
            background: #e0b000;
        }

        /* --- ××•×“××œ ××™×“×¢ (i) ×—×“×© (××•×¡×ª×¨) --- */
        #info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 101; /* Above API modal */
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        #info-modal-content {
            background: #111;
            padding: 25px;
            border-radius: 12px;
            border: 3px solid #00ffff; /* Cyan border */
            box-shadow: 0 0 20px #00ffff55;
            width: 90%;
            max-width: 450px;
            display: flex;
            flex-direction: column;
            align-items: center;
            direction: rtl;
            text-align: center;
            color: #eee;
        }
        #info-modal-content img {
            width: 100%;
            max-width: 250px; /* Control image size */
            height: auto;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid #00ffff;
        }
        #info-modal-content p {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        #info-modal-content button {
            padding: 10px 20px;
            background: #00ffff;
            color: #000;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }
        #info-modal-content button:hover {
            background: #99ffff;
        }

        /* ×”×ª×××ª ××•×“××œ ×”××™×“×¢ (i) ×œ××•×‘×™×™×œ */
        @media (max-width: 600px) {
            #info-modal-content {
                padding: 15px; /* ×¤×—×•×ª ×¨×™×¤×•×“ */
                width: 90%; 
                max-height: 80vh; /* ×’×•×‘×” ××§×¡×™××œ×™ */
                overflow-y: auto; /* ×××¤×©×¨ ×’×œ×™×œ×” ×¤× ×™××™×ª ×× ×”×ª×•×›×Ÿ ××¨×•×š */
                box-sizing: border-box; /* ×œ×•×•×“× ×©×”×¨×™×¤×•×“ × ×›×œ×œ ×‘×¨×•×—×‘ */
            }
            #info-modal-content img {
                max-width: 150px; /* ×ª××•× ×” ×§×˜× ×” ×™×•×ª×¨ */
                margin-bottom: 15px;
            }
            #info-modal-content p {
                font-size: 14px; /* ×˜×§×¡×˜ ×§×˜×Ÿ ×™×•×ª×¨ */
                margin-bottom: 15px;
            }
            #info-modal-content button {
                padding: 10px 15px; /* ×›×¤×ª×•×¨ ×¡×’×™×¨×” ×§×˜×Ÿ ×™×•×ª×¨ */
            }
        }
        
    </style>
</head>
<body>
    
    <!-- ××•×“××œ ×œ×”×–× ×ª API Key -->
    <div id="api-modal">
        <div id="api-modal-content">
            <h3 style="color: #FFD700; margin-top: 0;">×”×–× ×ª ××¤×ª×— API</h3>
            <p style="color: #ccc; font-size: 14px; text-align: center;">×™×© ×œ×”×›× ×™×¡ ××¤×ª×— Gemini/Google API ×›×“×™ ×œ××¤×©×¨ ×¢×“×›×•× ×™ × ×ª×•× ×™× ×‘×–××Ÿ ×××ª (×—×“×©×•×ª, ×‘×•×¨×¡×”, ××–×’ ××•×•×™×¨).</p>
            <input type="password" id="apiKeyInput" placeholder="×”×“×‘×§ ××¤×ª×— API ×›××Ÿ" dir="ltr">
            <button onclick="setApiKey(true)">×©××•×¨ ×•×¢×“×›×Ÿ</button>
        </div>
    </div>
    
    <!-- ××•×“××œ ××™×“×¢ (i) -->
    <div id="info-modal" onclick="hideInfoModal()">
        <div id="info-modal-content" onclick="event.stopPropagation()">
            <img src="https://raw.githubusercontent.com/orengamchi/fishy_news/main/WhatsApp%20Image%202025-11-05%20at%2006.39.54.jpeg" alt="×“×™×™×œ×™ ×”×“×’">
            <p>×”×××©×§ ××•×§×“×© ×œ×“×™×™×œ×™ ×”×“×’ ×©×™×œ×•×•×” ××•×ª× ×• ×‘××™× ×¡×•×¢×¨×™× ×‘×œ×™ ×œ×”×•×¦×™× ××™×œ×”, ×™×”×™×” ×–×›×¨×• ×‘×¨×•×š</p>
            <button onclick="hideInfoModal()">×¡×’×•×¨</button>
        </div>
    </div>


    <div id="ui-container">
        <!-- ×›×¤×ª×•×¨×™ ××™×§×•× ×™× ×“×™× ××™×™× (×‘×©×•×¨×”) -->
        <div id="controls-group">
            <button class="icon-button data-button" id="newsButton" onclick="updateQuotes('news')" title="×—×“×©×•×ª ×›×œ×œ×™×•×ª">ğŸ“°</button>
            <button class="icon-button data-button" id="i24newsButton" onclick="updateQuotes('i24news')" title="I24 NEWS">ğŸŒ</button>
            <button class="icon-button data-button" id="techButton" onclick="updateQuotes('tech')" title="×”×™-×˜×§ / ×¡×™×™×‘×¨">ğŸ’»</button>
            <button class="icon-button data-button" id="sportButton" onclick="updateQuotes('sport')" title="×¡×¤×•×¨×˜">âš½</button>
            <button class="icon-button data-button" id="stockButton" onclick="updateQuotes('stock')" title="×‘×•×¨×¡×”">ğŸ’°</button>
            <button class="icon-button data-button" id="weatherButton" onclick="updateQuotes('weather')" title="××–×’ ××•×•×™×¨">â˜€ï¸</button>
            <button id="infoButton" class="icon-button" onclick="showInfoModal()" title="××•×“×•×ª">â„¹ï¸</button>
        </div>
        
        <!-- ×›×¤×ª×•×¨ ×”×§×¤××” -->
        <button id="pauseButton" onclick="togglePause()" title="×”×§×¤××”/×”××©×š">â¸ï¸</button>
        <!-- ×›×¤×ª×•×¨ ×—×–×¨×” ×œ×‘×“×™×—×•×ª -->
        <button id="jokesButton" class="icon-button data-button" onclick="returnToJokes()" title="×—×–×¨×” ×œ×‘×“×™×—×•×ª">ğŸ </button>
        <!-- ×›×¤×ª×•×¨ API (×›×ª×•×, ×œ×”×¦×’×ª ×”××•×“××œ) -->
        <button id="apiButton" onclick="showApiModal()" title="×”×–×Ÿ ××¤×ª×— API">ğŸ”‘</button>

        <div id="statusMessage"></div>
    </div>
    
    <!-- ×˜×¢×™× ×ª ×¡×¤×¨×™×•×ª Three.js ××”×¨×©×ª -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/loaders/RGBELoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <script>
        // --- ×§×‘×•×¢×™× ×•××©×ª× ×™× ×’×œ×•×‘×œ×™×™× ---
        let API_KEY = ""; 
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=`;
        
        const STATUS_MESSAGE = document.getElementById('statusMessage');
        let isPaused = false; 
        const fishes = []; 

        const ANCHOR_GROUPS = {
            general: [
                { name: "×™×•× ×™×ª ×œ×•×™", icon: "ğŸ“º" },
                { name: "×“× ×™ ×§×•×©××¨×•", icon: "ğŸ“°" },
                { name: "×¨×™× ×” ××¦×œ×™×—", icon: "ğŸ¤" },
                { name: "××•×“×™ ×¡×’×œ", icon: "ğŸ™ï¸" },
                { name: "×‘×Ÿ ×›×¡×¤×™×ª", icon: "ğŸ“" }
            ],
            i24news: [ 
                { name: "×§×¨×•×œ×™×Ÿ ×’×œ×™×§", icon: "ğŸŒ" },
                { name: "×¢××™×ª ×¡×’×œ", icon: "ğŸ‡®ğŸ‡±" },
                { name: "××“××•×Ÿ ×œ×•×™", icon: "ğŸŒ" },
                { name: "×œ×•×¡×™ ××”×¨×™×©", icon: "ğŸ¤" },
                { name: "×™×¢×§×‘ ××—×™×××™×¨", icon: "ğŸŒ" }
            ],
            finance: [
                { name: "×§×¨×Ÿ ××¨×¦×™×× ×•", icon: "ğŸ’°" },
                { name: "××™×§×™ ×—×™×•×ª", icon: "ğŸ“ˆ" },
                { name: "× ×—××™×” ×©×˜×¨×¡×œ×¨", icon: "ğŸ“Š" }
            ],
            tech: [
                { name: "×’×™× ×œ×•×™", icon: "ğŸ’»" },
                { name: "×˜×œ ×‘×¨××Ÿ", icon: "ğŸ¤–" },
                { name: "×”×™×œ×” ×§×•×¨×—", icon: "ğŸŒ" }
            ],
            sport: [
                { name: "×©×¨×•×Ÿ ×¤×¨×™", icon: "âš½" },
                { name: "××•×˜×™ ×¤×©×›×¦×§×™", icon: "ğŸ€" },
                { name: "×¨×– ×–×”×‘×™", icon: "ğŸ†" }
            ],
            weather: [
                { name: "×“× ×™ ×¨×•×¤", icon: "â˜€ï¸" },
                { name: "×¡×™×•×Ÿ ×§×œ×™×™×Ÿ", icon: "ğŸŒ¡ï¸" },
                { name: "× ×—××Ÿ ×¡×™×¨×§×™×Ÿ", icon: "â›ˆï¸" }
            ]
        };
        let currentAnchorType = 'general'; 

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.01, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });

        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.0;
        document.body.appendChild(renderer.domElement);

        // --- (×—×“×©) ×××–×™× ×™× ×œ×œ×—×™×¦×” ×›×¤×•×œ×” / ×”×§×©×” ×›×¤×•×œ×” ×œ×”×§×¤××” ---
        let lastTap = 0;
        renderer.domElement.addEventListener('dblclick', (e) => {
            e.preventDefault();
            togglePause();
        });

        renderer.domElement.addEventListener('touchstart', (e) => {
            // ×××–×™×Ÿ ×–×” ×§×™×™× ×œ××˜×” ×¢×‘×•×¨ ×œ×—×™×¦×” ×›×¤×•×œ×”, ××š ×× ×• ××•×¡×™×¤×™× ×›××Ÿ ××ª ×ª×—×™×œ×ª ×”×¦×‘×™×˜×”
            if (e.touches.length === 2) {
                lastPinchDist = getPinchDist(e);
            }

            // ×œ×•×’×™×§×ª ×”×§×©×” ×›×¤×•×œ×”
            if (e.touches.length === 1) {
                const currentTime = new Date().getTime();
                const tapLength = currentTime - lastTap;
                if (tapLength < 300 && tapLength > 0) {
                    // ×–×•×”×™ ×”×§×©×” ×›×¤×•×œ×”
                    e.preventDefault();
                    togglePause();
                }
                lastTap = currentTime;
            }
        }, { passive: false }); // ** ×ª×™×§×•×Ÿ: ×©×•× ×” ×œ-false ×›×“×™ ×œ××¤×©×¨ preventDefault ×•×œ×× ×•×¢ ×–×•× ×‘××•×‘×™×™×œ **

        // --- ×‘×§×¨×•×ª ×•××¦×œ××” ---
        camera.position.set(1, -3, 10); 
        camera.lookAt(5, -5, 5); 

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.target.set(5, -5, 5); 
        controls.minDistance = 5;
        controls.maxDistance = 100;
        
        // ** (×ª×™×§×•×Ÿ) ×”×’×“×¨×•×ª ×–×•×•×™×•×ª ×§×•×˜×‘×™×•×ª (×œ×× ×™×¢×ª ××¢×‘×¨ ×“×¨×š ×¨×¦×¤×”/×ª×§×¨×”) **
        controls.minPolarAngle = Math.PI * 0.45; // ××•× ×¢ ×™×¨×™×“×” ××ª×—×ª ×œ×¨×¦×¤×” (×”×¢×¨×š ×”×•×’×“×œ ×§×œ×•×ª)
        controls.maxPolarAngle = Math.PI * 0.55; // ××•× ×¢ ×¢×œ×™×™×” ××¢×œ ×”×ª×§×¨×” (×”×¢×¨×š ×”×•×§×˜×Ÿ ×§×œ×•×ª)
        
        controls.minAzimuthAngle = -Math.PI * 0.45; 
        controls.maxAzimuthAngle = Math.PI * 0.45; 
        
        controls.enableZoom = false; 

        // --- (×—×“×©) ×œ×•×’×™×§×ª ×–×•× ×™×“× ×™×ª (FOV) ---
        const MIN_FOV = 40;
        const MAX_FOV = 120;
        const ZOOM_SPEED = 0.05;
        let lastPinchDist = 0;

        function getPinchDist(event) {
            const dx = event.touches[0].clientX - event.touches[1].clientX;
            const dy = event.touches[0].clientY - event.touches[1].clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        renderer.domElement.addEventListener('wheel', (event) => {
            event.preventDefault();
            
            const delta = event.deltaY > 0 ? 1 : -1;
            
            let newFov = camera.fov + delta * (camera.fov * ZOOM_SPEED);
            camera.fov = THREE.MathUtils.clamp(newFov, MIN_FOV, MAX_FOV);
            
            camera.updateProjectionMatrix();
        }, { passive: false });

        renderer.domElement.addEventListener('touchmove', (event) => {
            if (event.touches.length === 2) {
                event.preventDefault(); 
                
                const currentPinchDist = getPinchDist(event);
                const delta = currentPinchDist - lastPinchDist;
                
                let newFov = camera.fov - delta * (ZOOM_SPEED * 1.5); 
                camera.fov = THREE.MathUtils.clamp(newFov, MIN_FOV, MAX_FOV);
                
                camera.updateProjectionMatrix();
                lastPinchDist = currentPinchDist;
            }
        }, { passive: false }); 

        renderer.domElement.addEventListener('touchend', () => {
            lastPinchDist = 0; 
        });
        // --- ×¡×•×£ ×œ×•×’×™×§×ª ×–×•× ×™×“× ×™×ª ---


        // --- ×ª××•×¨×” ×•×¡×‘×™×‘×” ---
        const rgbeLoader = new THREE.RGBELoader();
        rgbeLoader.load('https://dl.polyhaven.org/file/ph-assets/HDRIs/hdr/1k/aerodynamics_workshop_1k.hdr', (texture) => {
            texture.mapping = THREE.EquirectangularReflectionMapping;
            scene.environment = texture; 
        });

        const ambientLight = new THREE.AmbientLight(0x404040, 3.0);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0); 
        directionalLight.position.set(10, 25, 15);
        directionalLight.castShadow = true;
        directionalLight.shadow.mapSize.width = 2048;
        directionalLight.shadow.mapSize.height = 2048;
        directionalLight.shadow.camera.near = 1;
        directionalLight.shadow.camera.far = 50;
        directionalLight.shadow.camera.left = -30;
        directionalLight.shadow.camera.right = 30;
        directionalLight.shadow.camera.top = 30;
        directionalLight.shadow.camera.bottom = -30;
        scene.add(directionalLight);

        const spotLight = new THREE.SpotLight(0xffffff, 2.0, 40, Math.PI * 0.1, 0.5, 2);
        spotLight.position.set(0, 10, 0);
        spotLight.target.position.set(0, -5, 0); 
        spotLight.castShadow = true;
        spotLight.shadow.mapSize.width = 1024;
        spotLight.shadow.mapSize.height = 1024;
        scene.add(spotLight);
        scene.add(spotLight.target);
        
        // --- ×¨×§×¢ ×× ×™××˜×™×‘×™ ×’×œ×™ (Wave Grid Background) ---
        const backgroundMaterial = new THREE.ShaderMaterial({
            uniforms: {
                u_time: { value: 0.0 },
                u_resolution: { value: new THREE.Vector2(window.innerWidth, window.innerHeight) },
                u_color_deep: { value: new THREE.Color(0x051025) },
                u_color_light: { value: new THREE.Color(0x0a1f44) }
            },
            vertexShader: `
                uniform float u_time;
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    vec3 newPosition = position;
                    newPosition.z += sin(newPosition.x * 0.5 + u_time * 0.1) * 0.5;
                    newPosition.y += cos(newPosition.y * 0.5 + u_time * 0.15) * 0.5;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
                }
            `,
            fragmentShader: `
                uniform float u_time;
                uniform vec3 u_color_deep;
                uniform vec3 u_color_light;
                varying vec2 vUv;

                void main() {
                    vec3 color = mix(u_color_deep, u_color_light, sin(vUv.x * 10.0 + u_time * 0.2) * 0.5 + 0.5);
                    float wave = sin(vUv.y * 20.0 + u_time * 0.5) * 0.05 + 0.95;
                    color = mix(color, u_color_light, wave - 0.95);
                    gl_FragColor = vec4(color, 1.0);
                }
            `,
            side: THREE.BackSide,
            depthWrite: false
        });

        const backgroundGeometry = new THREE.SphereGeometry(500, 32, 32);
        const backgroundMesh = new THREE.Mesh(backgroundGeometry, backgroundMaterial);
        scene.add(backgroundMesh);
        
        // --- ××œ×× ×˜×™× ×¡×˜×˜×™×™× (×¤×•×“×™×•×, ×–×›×•×›×™×ª, ××¡×’×¨×ª) ---
        const podiumHeight = 15;
        const podiumGeometry = new THREE.BoxGeometry(34, podiumHeight, 34);
        const podiumMaterial = new THREE.MeshStandardMaterial({
            color: 0x4d4d4d,
            roughness: 0.1,
            metalness: 0.8,
            envMapIntensity: 4.0
        });
        const podium = new THREE.Mesh(podiumGeometry, podiumMaterial);
        podium.position.set(0, -10 - (podiumHeight / 2) - 0.25, 0); 
        podium.receiveShadow = true;
        podium.castShadow = true;
        scene.add(podium);

        const waterGeometry = new THREE.BoxGeometry(30, 20, 30);
        const waterMaterial = new THREE.MeshPhysicalMaterial({
            color: 0x00aaff,
            transparent: true,
            opacity: 0.5,
            roughness: 0.1,
            metalness: 0.05,
            clearcoat: 1.0,
            clearcoatRoughness: 0.1,
            side: THREE.DoubleSide,
            transmission: 0.95,
            ior: 1.33,
            envMapIntensity: 4.0
        });
        const water = new THREE.Mesh(waterGeometry, waterMaterial);
        water.receiveShadow = true;
        scene.add(water);

        const glassGeometry = new THREE.BoxGeometry(32, 22, 32);
        const glassMaterial = new THREE.MeshPhysicalMaterial({
            color: 0xffffff,
            transparent: true,
            opacity: 0.025, 
            roughness: 0.0,
            metalness: 0.0,
            transmission: 1.0,
            thickness: 0.01,
            ior: 1.5,
            envMapIntensity: 4.0
        });
        const glass = new THREE.Mesh(glassGeometry, glassMaterial);
        glass.receiveShadow = true;
        glass.castShadow = true;
        scene.add(glass);

        const FRAME_SIZE = 0.5;
        const FRAME_COLOR = 0xe0e0e0; 
        const frameMaterial = new THREE.MeshPhysicalMaterial({
            color: FRAME_COLOR,
            metalness: 1.0,
            roughness: 0.05, 
            clearcoat: 1.0,
            clearcoatRoughness: 0.1,
            envMapIntensity: 5.0
        });

        function createFrameBar(width, height, depth, x, y, z) {
            const geometry = new THREE.BoxGeometry(width, height, depth);
            const mesh = new THREE.Mesh(geometry, frameMaterial);
            mesh.position.set(x, y, z);
            mesh.castShadow = true;
            mesh.receiveShadow = true;
            scene.add(mesh);
        }
        
        const TANK_WIDTH = 32;
        const TANK_HEIGHT = 22;
        const TANK_DEPTH = 32;
        const HALF_WIDTH = TANK_WIDTH / 2;
        const HALF_HEIGHT = TANK_HEIGHT / 2;
        const HALF_DEPTH = TANK_DEPTH / 2;
        
        const cornerPositions = [
            [HALF_WIDTH + FRAME_SIZE / 2, 0, HALF_DEPTH + FRAME_SIZE / 2],
            [-HALF_WIDTH - FRAME_SIZE / 2, 0, HALF_DEPTH + FRAME_SIZE / 2],
            [HALF_WIDTH + FRAME_SIZE / 2, 0, -HALF_DEPTH - FRAME_SIZE / 2],
            [-HALF_WIDTH - FRAME_SIZE / 2, 0, -HALF_DEPTH - FRAME_SIZE / 2],
        ];
        cornerPositions.forEach(p => {
            createFrameBar(FRAME_SIZE, TANK_HEIGHT + FRAME_SIZE, FRAME_SIZE, p[0], p[1], p[2]);
        });
        
        const topY = HALF_HEIGHT + FRAME_SIZE / 2;
        const longBar = TANK_WIDTH + FRAME_SIZE;
        const shortBar = TANK_DEPTH + FRAME_SIZE;
        
        createFrameBar(longBar, FRAME_SIZE, FRAME_SIZE, 0, topY, HALF_DEPTH); 
        createFrameBar(longBar, FRAME_SIZE, FRAME_SIZE, 0, topY, -HALF_DEPTH);
        createFrameBar(FRAME_SIZE, FRAME_SIZE, shortBar, HALF_WIDTH, topY, 0);
        createFrameBar(FRAME_SIZE, FRAME_SIZE, shortBar, -HALF_WIDTH, topY, 0);
        
        const bottomY = -HALF_HEIGHT - FRAME_SIZE / 2;
        
        createFrameBar(longBar, FRAME_SIZE, FRAME_SIZE, 0, bottomY, HALF_DEPTH);
        createFrameBar(longBar, FRAME_SIZE, FRAME_SIZE, 0, bottomY, -HALF_DEPTH);
        createFrameBar(FRAME_SIZE, FRAME_SIZE, shortBar, HALF_WIDTH, bottomY, 0);
        createFrameBar(FRAME_SIZE, FRAME_SIZE, shortBar, -HALF_WIDTH, bottomY, 0);
        
        // --- ×—×¦×¥ ×•×¦××—×™×™×” ---
        const gravelCount = 50000; 
        const gravelGeometry = new THREE.BufferGeometry();
        const gravelPositions = new Float32Array(gravelCount * 3);
        const gravelColors = new Float32Array(gravelCount * 3);
        const gravelColorsList = [
            [0.5, 0.5, 0.5], [0.6, 0.4, 0.2], [0.9, 0.9, 0.9], [0.8, 0.2, 0.2]
        ];

        for (let i = 0; i < gravelCount; i++) {
            gravelPositions[i * 3] = Math.random() * 30 - 15;
            gravelPositions[i * 3 + 1] = -10 + Math.random() * 0.5;
            gravelPositions[i * 3 + 2] = Math.random() * 30 - 15;
            const color = gravelColorsList[Math.floor(Math.random() * gravelColorsList.length)];
            gravelColors[i * 3] = color[0];
            gravelColors[i * 3 + 1] = color[1];
            gravelColors[i * 3 + 2] = color[2];
        }

        gravelGeometry.setAttribute('position', new THREE.BufferAttribute(gravelPositions, 3));
        gravelGeometry.setAttribute('color', new THREE.BufferAttribute(gravelColors, 3));
        
        const gravelMaterial = new THREE.PointsMaterial({
            vertexColors: true,
            size: 0.15,
            transparent: true,
            opacity: 0.9,
            envMapIntensity: 4.0
        });

        const gravel = new THREE.Points(gravelGeometry, gravelMaterial);
        scene.add(gravel);

        const rockLoader = new THREE.GLTFLoader();
        const ROCK_URL = 'https://raw.githubusercontent.com/orengamchi/3d_models_collection/main/rock_photogrammetry_scan.glb';
        const ROCK_SCALE = 4.0;
        const ROCK_POSITION = new THREE.Vector3(5, -8, 5);

        rockLoader.load(ROCK_URL, (gltf) => {
            const rock = gltf.scene;
            rock.scale.set(ROCK_SCALE, ROCK_SCALE, ROCK_SCALE);
            rock.position.copy(ROCK_POSITION);
            rock.castShadow = true;
            rock.receiveShadow = true;
            
            rock.traverse((child) => {
                if (child.isMesh) {
                    child.castShadow = true;
                    child.receiveShadow = true;
                    if (child.material) {
                        child.material.envMapIntensity = 4.0;
                        child.material.needsUpdate = true;
                    }
                }
            });

            scene.add(rock);
        });

        const GLTF_LOADER = new THREE.GLTFLoader();
        const CORAL_URL = 'https://raw.githubusercontent.com/orengamchi/3d_models_collection/main/fan_coral_cluster_low.glb';
        const SPONGE_URL = 'https://raw.githubusercontent.com/orengamchi/3d_models_collection/main/tube_sponge.glb';
        const PLANT_SCALE = 80.0; 
        const NUM_CORALS = 4;
        const NUM_SPONGES = 3;

        function loadAndPlacePlant(url, count, scale, yOffset = 0) {
            GLTF_LOADER.load(url, (gltf) => {
                const sourcePlant = gltf.scene;
                
                sourcePlant.traverse((child) => {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = true;
                        if (child.material) {
                            const originalMaterial = child.material;
                            let newMaterial = originalMaterial;
                            
                            if (!originalMaterial.isMeshStandardMaterial && !originalMaterial.isMeshPhysicalMaterial) {
                                newMaterial = new THREE.MeshStandardMaterial().copy(originalMaterial);
                            } else {
                                newMaterial = originalMaterial.clone();
                            }
                            
                            newMaterial.envMapIntensity = 3.0;
                            newMaterial.metalness = 0.1;
                            newMaterial.roughness = 0.8;
                            newMaterial.needsUpdate = true;

                            if (newMaterial.map) {
                                newMaterial.transparent = true;
                                newMaterial.alphaTest = 0.5;
                                newMaterial.side = THREE.DoubleSide; 
                            }

                            child.material = newMaterial;
                        }
                    }
                });

                for (let i = 0; i < count; i++) {
                    const plantInstance = sourcePlant.clone();
                    plantInstance.scale.set(scale, scale, scale);

                    plantInstance.position.set(
                        Math.random() * 20 - 10,
                        -10 + yOffset,
                        Math.random() * 20 - 10
                    );
                    plantInstance.rotation.y = Math.random() * Math.PI * 2;
                    scene.add(plantInstance);
                }
            });
        }
        
        loadAndPlacePlant(CORAL_URL, NUM_CORALS, PLANT_SCALE, 0); 
        loadAndPlacePlant(SPONGE_URL, NUM_SPONGES, PLANT_SCALE, 0); 


        // --- ×œ×•×’×™×§×ª ×“×’×™× ×•×‘×•×¢×•×ª ×“×™×‘×•×¨ ---
        
        const ORIGINAL_JOKES = [
            "××” ×”××™× ×§×¨×™× ×”×™×•×!", "×©××¢×ª ×¢×œ ×”×“×’ ×©×”×œ×š ×œ×‘×™×ª ×¡×¤×¨?", "×× ×™ ×“×’ ×¢× ×—×œ×•××•×ª ×’×“×•×œ×™×!", 
            "××™ ×¦×¨×™×š ××•×•×™×¨ ×›×©×™×© ××™×?", "×¡× ×¤×™×¨ ×™××™×Ÿ, ×¡× ×¤×™×¨ ×©×××œ, ×ª××©×™×š ×œ×©×—×•×ª!", "×× ×™ ×××© ×–×•×¨× ×¢× ×”×–×¨×!",
            "××œ ×ª×¡×ª×›×œ ×¢×œ×™×™, ×× ×™ ×¨×§ ×“×’ ×§×˜×Ÿ!", "×œ××” ×“×’×™× ×œ× ××©×—×§×™× ×›×“×•×¨×¡×œ? ×›×™ ×”× ××¤×—×“×™× ××”×¨×©×ª!",
            "××” ×××¨ ×”×“×’ ×œ×“×’ ×”×©× ×™? ×ª×–×¨×•× ××™×ª×™!", "×œ××” ×”×“×’ ×”×œ×š ×œ×¨×•×¤×? ×›×™ ×”×•× ×”×¨×’×™×© ×“×’×“×•×’ ×‘×’×¨×•×Ÿ.",
            "××™×š ×“×’×™× ××ª×§×©×¨×™×? ×”× ×©×•×œ×—×™× ××¡×¨×™×—×™×.", "××” ×”×“×’ ×¢×•×©×” ×‘×‘× ×§? ××¤×§×™×“ ×¦'×§×™× ×¨×˜×•×‘×™×.",
            "×œ××” ×“×’×™× ×©×•× ××™× ××—×©×‘×™×? ×›×™ ×™×© ×‘×”× ×•×™×¨×•×¡×™×.", "××” ×××¨ ×”×“×’ ×›×©×¤×’×© ×—×•××”? ×¡×›×¨!",
            "×œ××” ×”×“×’ ×§×™×‘×œ ×§× ×¡? ×›×™ ×”×•× ×—× ×” ×‘××§×•× ××¡×•×¨ ×œ×©×—×•×ª.", "××™×š ×§×•×¨××™× ×œ×“×’ ×‘×œ×™ ×¢×™× ×™×™×? ×“×’!",
            "××” ×”×“×’ ××•×”×‘ ×œ××›×•×œ? ×¤×™×¦×” ×¢× ×× ×©×•×‘×™.", "×œ××” ×”×“×’×™× ×©×§×˜×™×? ×›×™ ×”× ××ª×—×ª ×œ××™×.",
            "××” ×”×“×’ ×¢×•×©×” ×›×©×”×•× ×›×•×¢×¡? ×”×•× ×¨×•×ª×— ×××™×.", "×œ××” ×”×“×’ ×”×œ×š ×œ×‘×™×ª ×¡×¤×¨? ×›×“×™ ×œ×”×™×•×ª ×—×›× ×™×•×ª×¨.",
            "××™×š ×“×’×™× ×—×•×’×’×™×? ×”× ×¢×•×©×™× ××¡×™×‘×” ×‘×‘×¨×™×›×”.", "××” ×××¨ ×”×“×’ ×œ×“×’×”? ××ª ×©×•×—×” ×œ×™ ×‘×œ×‘.",
            "×œ××” ×”×“×’×™× ×œ× ×¢×•×©×™× ×“×™××˜×”? ×›×™ ×”× ××•×”×‘×™× ×œ××›×•×œ ×›××• ×“×’×™×.", "××” ×”×“×’ ××•××¨ ×›×©×”×•× ×¨×•××” ×¡×¤×™× ×”? ××•×™ ×œ×, ×‘× ×™ ××“×!",
            "×œ××” ×”×“×’×™× ×œ× ××©×—×§×™× ×§×œ×¤×™×? ×›×™ ×”× ××¤×—×“×™× ××”×›×¨×™×©×™×.", "××™×š ×“×’×™× ×›×•×ª×‘×™×? ×‘×¢×˜ ×“×™×•.",
            "××” ×”×“×’ ×¢×•×©×” ×‘×¡×•×¤×©×‘×•×¢? × ×— ×¢×œ ×”×¡×¤×” ×¨×˜×•×‘×”.", "××”×• ×”×“×’ ×”×§× ××™ ×‘×™×•×ª×¨? ×“×’ ×”××“×•×–×”",
            "××™×¤×” ×“×’×™× ×©×•××¨×™× ××ª ×”×›×¡×£ ×©×œ×”×? ×‘×’×“×•×ª ×”× ×”×¨.", "××™×¤×” ×“×’×™× ×™×©× ×™×? ×‘××™×˜×ª ×”× ×”×¨",
            "××” ×”×—×œ×§ ×”×›×‘×“ ×‘×™×•×ª×¨ ×‘×“×’? ×”×§×©×§×©×™×.", "××™×š ×§×•×¨××™× ×œ×“×’ ×¢× 10 ×¢×™× ×™×™×? ×“×’ggggg.",
            "××™×–×” ×›×œ×™ × ×’×™× ×” ×¢×•×–×¨ ×œ×ª×¤×•×¡ ×“×’×™×? ×§×¡×˜× ×˜×™×", "××™×š ×™×•×¦×¨×™× ×¤×ª×™×•× ×•×ª ×“×™×™×’? ×¢×œ ×™×“×™ ×™×¦×™×§×” ×©×œ×”×",
            "××™×–×” ××•×–×™×§×” ×“×’×™× ××•×”×‘×™× ×œ×¨×§×•×“ ×‘×”? ×“×¨×× ×•×‘×¡.", "××™×–×” ×“×’ × ×©××¢ ×›××• × ×‘×œ? ×§×¨×¤×™×•×Ÿ.",
            "××™×–×” ×¡×•×’ ×“×’ ×©×™×™×š ×œ×§×¨×§×¡? ×“×’ ×œ×™×¦×Ÿ.", "××™×¤×” ××•×¦××™× ×“×’ ×‘××¡×œ×•×œ? ×‘×—×œ×œ ×”×—×™×¦×•×Ÿ.",
            "×œ××” ×”×“×’ ×”×¡××™×§? ×›×™ ×”×•× ×¨××” ××ª ×§×¨×§×¢×™×ª ×”××•×§×™×™× ×•×¡.", "××™×š ×ª×•×¤×¡×™× ×“×’ ×¢× ××—×©×‘? ××©×ª××©×™× ×‘×¤×™×ª×™×•×Ÿ ×œ×—×™×¦×”.",
            "××” ×××¨ ×”×“×’ ×œ×—×‘×¨×• ×©×”×ª× ×”×’ ×‘×‘×™×©× ×•×ª? ×ª×¤×¡×™×§ ×œ×”×™×•×ª ×›×œ ×›×š ×§×•×™.", "××” ×”×”×‘×“×œ ×‘×™×Ÿ ×¤×¡× ×ª×¨ ×œ×“×’? ××¤×©×¨ ×œ×›×•×•×Ÿ ×¤×¡× ×ª×¨, ××‘×œ ××™ ××¤×©×¨ ×œ×›×•×•×Ÿ ×“×’ ×˜×•× ×”.",
            "××™×š ×§×•×¨××™× ×œ×“×’ ×§×•×™ ××–×•×™×£? ×“×” ×§×•×™", "××” ×”××¨×•×—×” ×”××”×•×‘×” ×¢×œ ×›×¨×™×©? ×“×’ ×•×¦'×™×¤×¡.",
            "××™×š ×§×•×¨××™× ×œ×©×™×¨ ×“×ª×™ ×©×œ ×“×’? ×ª×”×™×œ×™×.", "××™×š ×§×•×¨××™× ×œ×“×’ ×©××ª×§×©×” ×œ×œ×›×ª? ×œ×™××¤×™×Ÿ ×§×¨×¤",
            "×œ××” ×“×’×™× ×©×•×—×™× ×‘×‘×ª×™ ×¡×¤×¨? ×›×™ ×”× ×œ× ×™×›×•×œ×™× ×œ×œ×›×ª.", "×œ××” ×œ× ×œ×”×–××™×Ÿ ×“×™ ×’'×™×™ ×œ×˜×™×•×œ ×“×™×’? ×”× ×ª××™×“ ×–×•×¨×§×™× ××ª ×”×‘×¡",
            "××™×š ×§×•×¨××™× ×œ×©× ×™ ×“×’×™ ×‘×¨×§×•×“×”? ×–×•×’×§×•×“×”.", "××™×–×” ×¡×•×’ ×“×’ ××•×”×‘ ×œ× ×¡×•×ª ××•×›×œ ×—×“×©? ×‘×•×“×§ ×‘×˜×.",
            "×ª×Ÿ ×œ××“× ×“×’, ×”×•× ××•×›×œ ×œ×™×•× ××—×“. ××” ×§×•×¨×” ×× ×ª×œ××“ ××“× ×œ×”×ª×›×•×¤×£? ×”×•× × ×× ×¢ ××œ×”×™×›× ×¡ ×œ×‘×¨.",
            "××” ××™×œ×¥ ×”×“×’ ×”×¤×™×¨××˜ ××ª ×“×’ ×”××¡×™×¨ ×œ×¢×©×•×ª? ×œ×œ×›×ª ××ª ×”×¤×œ× ×§×˜×•×Ÿ.", "×œ××” ×“×’×™× ×œ× ××•×”×‘×™× ×œ×©×—×§ ×›×“×•×¨×¡×œ? ×›×™ ×”× ××¤×—×“×™× ××”×¨×©×ª×•×ª.",
            "×œ××” ×”×›×œ×‘ ×§×¤×¥ ××”×¡×™×¨×” ×œ××•×§×™×™× ×•×¡? ×”×•× ×—×©×‘ ×©×”×•× ×¨××” ×“×’ ×—×ª×•×œ", "××™×š ×§×•×¨××™× ×œ×“×’ ×©×™×›×•×œ ×œ×˜×‘×•×¢? ×¡×•×•×•×©×™.",
            "××” ×××¨ ×”×“×’ ×›×©×”×•× ×”×ª× ×’×© ×‘×¡×›×¨? ××™× ×•××™×.", "××™×–×” ××•×–×™×§×” ×“×’×™× ××§×©×™×‘×™×? ××©×”×• ×ª×•×¤×¡.",
            "×œ××™×–×” ××“×™× ×” ×“×’×™× ××•×”×‘×™× ×œ× ×¡×•×¢ ×œ×—×•×¤×©×”? ×¤×™× ×œ× ×“", "××™ ×”×•×•×œ× ×˜×™×™×Ÿ ×©×œ ×”×“×’? ×”×—×‘×¨×” ×©×œ×•!",
            "×œ××” ×”×“×’ ×§×™×‘×œ ×¦×™×•× ×™× ×¨×¢×™×? ×›×™ ×”×•× ×”×™×” ××ª×—×ª ×œ×¨××ª ×”×™×.", "××™×–×” ×¡×•×’ ×“×’ ××•×›×œ ×¢×›×‘×¨×™×? ×“×’ ×—×ª×•×œ",
            "××” ×œ×•×•×™×™×ª× ×™× ××•×›×œ×™× ×œ××¨×•×—×ª ×¢×¨×‘? ×”× ××•×›×œ×™× ×“×’×™× ×•×¡×¤×™× ×•×ª.", "××” ×××¨ ×”×“×’ ×œ×“×™×™×’? '××£ ××—×“ ×œ× ×™×××™×Ÿ ×œ×š.'",
            "××™×–×” ×¡×•×’ ×“×’ ×™×•×¦× ×¨×§ ×‘×œ×™×œ×”? ×›×•×›×‘ ×™×.", "××™×š ×§×•×¨××™× ×œ×“×’ ×‘×œ×™ '×¢×™×Ÿ'? ×“×’",
            "××” ××›×œ ×›×¨×™×© ×¢× ×›×¨×™×š ×—×××ª ×‘×•×˜× ×™×? ××“×•×–×”.", "××™×š ×§×•×¨××™× ×œ×“×’ ×¢× ×¢× ×™×‘×ª ×¤×¨×¤×¨? ×¡×•-×“×’-×™×¡×˜×™×§×™×™×˜×“",
            "××™×š ××–×”×™× ×“×’ ×¡×™× ×“×¨×œ×”? ×™×© ×œ×• ×›×¤×›×¤×™ ×–×›×•×›×™×ª", "××™×¤×” ×“×’×™× ×”×•×œ×›×™× ×œ×”×œ×•×•×ª ×›×¡×£? ×œ×”×œ×•×•××ª ×›×¨×™×©.",
            "××™×š ×§×•×¨××™× ×œ×“×’ ×©××¡×¤×§ ×©×™×¨×•×ª×™ ×’×™× ×”, ×‘×¢×™×§×¨ ×’×™×–×•× ×•×˜×™×¤×•×œ×™× ×œ×¢×¦×™× ×™×©× ×™× ××• ×¤×’×•××™×. ×× ×ª×— ×¢×¦×™×",
            "××™×š ×§×•×¨××™× ×œ×“×’ ×¢× ×”×¨×‘×” ×›×¡×£? ×“×’ ×–×”×‘.", "××” ×××¨ ×”×“×’ ×›×©×¨××” ×—×‘×¨ ×™×©×Ÿ ×©×œ× ×¨××™×ª×™ ×™×? ×–××Ÿ ×¨×‘ ×œ× ×¨××™×ª×™ ×™×.",
            "××™×š ×¦×“×¤×•×ª ××’×™×¢×•×ª ×œ×‘×™×ª ×—×•×œ×™×? ×‘×××‘×•×œ× ×¡ ×¦×“×¤×”.", "××” ×“×’×™× ×œ×•×§×—×™× ×›×“×™ ×œ×”×™×©××¨ ×‘×¨×™××™×? ×•×™×˜××™×Ÿ ×™×.",
            "××™×š ×§×•×¨××™× ×œ×“×’ ××•×¤×¢×œ ×¡××-××•×Ÿ", "××™×–×” ×™×•× ×‘×©×‘×•×¢ ×›×œ ×”×“×’×™× ×©×•× ××™× ×‘×™×•×ª×¨? ×™×•× ×©×™×©×™.",
            "××™ ×”×“×’ ×”×¢×©×™×¨ ×‘×™×•×ª×¨ ×‘×™×? ×’×™×œ ×’×™×™×˜×¡, ××™×™×¡×“ ××§×¨×œ×¡×•×¤×˜", "×œ××” ×“×•×œ×¤×™× ×™× ×—×›××™× ×™×•×ª×¨ ××‘× ×™ ××“×? ×‘××¨×—×‘ ×©×œ 2 ×©×¢×•×ª, ×”× ×™×›×•×œ×™× ×œ×××Ÿ ××“× ×œ×¢××•×“ ×‘×¦×“ ×”×‘×¨×™×›×” ×•×œ×”××›×™×œ ××•×ª× ×“×’×™×.",
            "××™×š ×§×•×¨××™× ×œ×“×’ ×‘×œ×™ ×¨×’×œ×™×™×? ×“×’.", "××™×¤×” ×“×’×™ ×–×”×‘ ××•×”×‘×™× ×œ×˜×™×™×œ? ×‘×“×¨×š ×›×œ×œ ×¨×§ ××¡×‘×™×‘ ×œ×›×“×•×¨.",
            "××” ×××¨ ×“×’ ××—×“ ×œ×©× ×™? ×©××•×¨ ×¢×œ ×”×¤×” ×¡×’×•×¨ ×•×œ× ×ª×™×ª×¤×¡!", "××™×š ×”×¦×“×¤×” ×”×¦×œ×™×—×” ×œ×”×ª×—×‘× ××”×“×’? ×”×¡×•×•××” ×¦×“×¤×”!",
            "×“×¤×•×§, ×“×¤×•×§. ××™ ×©×? ×“×’. ×“×’ ××™? ×“×’ ×œ×š ×—×’ ××•×œ×“ ×©××—, ×“×’ ×œ×š ×—×’ ××•×œ×“ ×©××—!", "×“×¤×•×§, ×“×¤×•×§. ××™ ×©×? ×“×’. ×“×’ ××™? ×‘×¨×›×•×ª!",
            "×“×¤×•×§, ×“×¤×•×§. ××™ ×©×? ×“×’. ×“×’ ××™? ××–×’ ×“×’-×™ ×©××ª×” ×©×, ×ª×™×¨×’×¢!", "×“×¤×•×§, ×“×¤×•×§. ××™ ×©×? ××¨×˜×™ ×“×’. ××¨×˜×™ ×“×’ ××™? ××¨×˜×™ ×“×’-×œ ××™× ×˜×œ×™×’× ×¦×™×”.",
            "×œ×§×—×ª×™ ××ª ×”×œ×¤×˜×•×¤ ×©×œ×™ ×œ×¡×™×¨×ª ×”×“×™×’ ×™×•× ××—×“ ×›×©×”×•× × ×¤×œ. ×–×” ×”×™×” ××“×œ, ××ª×’×œ×’×œ ×‘×¢×•××§.", "×”×—×‘×¨ ×©×œ×™ ×—×•×©×‘ ×©×”×•× ×“×’ ××‘×œ ×”×•× ×˜×•×¢×”. ×”×•× ×—×™ ×‘× ×™×œ×•×¡.",
            "×“×’ × ×¢×¦×¨ ×•×¢×•××“ ××•×œ ×—×‘×¨ ×”××•×©×‘×¢×™× ×‘×‘×™×ª ××©×¤×˜. ×”×©×•×¤×˜ ××•××¨ ×œ×—×‘×¨ ×”××•×©×‘×¢×™× '××™×š ××ª× ××•×¦××™× ××ª ×”× ××©× ×”×“×’' ×—×‘×¨ ××•×©×‘×¢×™× ×§× ×•××•××¨ '×× ×—× ×• ××•×¦××™× ××ª ×”×“×’ ××©×'",
            "×¡×‘× ×•× ×›×“×• ××—×¤×©×™× ×‘×’×™× ×” ×ª×•×œ×¢×™× ×“×™×’ ×›×“×™ ×œ×”×©×ª××© ×›×¤×™×ª×™×•×Ÿ. ×”× × ×ª×§×œ×™× ×‘×”×¨×‘×” ×—×¨×§×™× ××‘×œ ×©×•× ×“×‘×¨ ××ª××™× ×œ×¤×™×ª×™×•×Ÿ ×¢×“ ×©×”× ×›×“ ××—×–×™×§ ×‘×’××•×•×” ×—×¨×§ ×ª×œ×•×™ ××¨×•×š. ×”× ×¢×¨ ×§×•×¨× '××¦××ª×™ ×¤×™×ª×™×•×Ÿ, ×¡×‘×'. ×¡×‘× ××’×™×‘ '××¦×˜×¢×¨, ×™×œ×“, ×× ×—× ×• ×œ× ×™×›×•×œ×™× ×œ×”×©×ª××© ×‘×–×”. ×–×” ×œ× ×ª×•×œ×¢×ª ××“××”.' ×”× ×›×“ ××’×™×‘ '×˜×•×‘, ×××™×–×” ×›×•×›×‘ ×œ×›×ª ×–×” ×‘×, ×¡×‘×?'",
            "××ª××•×œ ×©×ª×™×ª×™ ×›×•×¡ ×§×¤×” ×¢× ×¤×™× ×’×•×•×™×Ÿ. ×”×•× ×××¨ ×©×”×•× ×”×™×” ××¢×“×™×£ ×“×’.", "×—×©×‘×ª ×¢×œ ×‘×“×™×—×ª ×“×’ ×¢×“×™×™×Ÿ ××• ×©××ª×” ×¦×¨×™×š ×¢×•×“ ×–××Ÿ ×œ×”×ª×¢××§?",
            "×—×™×¤×©×ª×™ ×¦×“×¤×•×ª ×‘×—×•×£ ×”××§×•××™ ×©×œ×™ ×›×œ ×™×•× ×¢×“ ×™×•× ××—×“ ×›×©××©×›×ª×™ ×©×¨×™×¨.", "×–×” ×¢×•×‘×“×” ×™×“×•×¢×” ×©×”×“×’ ×—×¨×‘ ×”×•× ×”×—×™×” ×”××ª×œ×‘×©×ª ×”×˜×•×‘×” ×‘×™×•×ª×¨ ×‘××•×§×™×™× ×•×¡. ×”×•× ×ª××™×“ ××ª×œ×‘×© ×—×“.",
            "×¦×¤×™×ª×™ ×‘×¡×¨×˜ ×¢×œ ×“×™×’. ×”×™×” ×œ×• ×¦×•×•×ª × ×”×“×¨.", "××” ×©×¨ ×”×“×’ ×©×”×™×” ××¢×¨×™×¥ ×’×“×•×œ ×©×œ ×¨×™×§ ××¡×˜×œ×™? ×œ×¢×•×œ× ×œ× ×œ×•×•×ª×¨ ×¢×œ×™×š! ×œ×¢×•×œ× ×œ× ×œ×ª×ª ×œ×š ×œ×˜×‘×•×¢! ×œ×¢×•×œ× ×œ× ×œ×©×—×•×ª ×¡×‘×™×‘ ×•×œ×©×¤×¨×™×¥ ××•×ª×š!",
            "×©××¢×ª ×¢×œ ×”×‘×—×•×¨ ×‘××©×¤×˜ ×¢×œ ×¨×¦×— ×©×× ×¡×” ×œ×”×ª×—××§ ×‘×¢×•× ×© ×‘×××¦×¢×•×ª ×˜×¢× ×ª ××™ ×©×¤×™×•×ª ×¢×œ ×™×“×™ ×”×¢××“×ª ×¤× ×™× ×©×”×•× ×“×’? ×”×•× × ×™×¡×” ×œ×”×™×•×ª ×§×•×™",
            "×©××œ×ª×™ ××ª ×‘×¢×œ ×”××§×•×•×¨×™×•× ×¢×œ ×”×“×’ ×”×”×•×œ×š. ×”×•× ×××¨ '××ª×” ×©×•××œ ×”×¨×‘×” ×©××œ×•×ª!'", "×’×™×“×œ×ª×™ ×“×’×™ ×¡×™×××™×™× ×œ× ××’×¨×¡×™×‘×™×™×. ×× ×™ ×§×•×¨× ×œ×”× ×‘×˜× ×‘×˜××¡.",
            "×“×’ ×§×˜×Ÿ × ×›× ×¡ ×œ×‘×¨. ×”×‘×¨××Ÿ ×©×•××œ ××ª ×”×“×’ '××” ×× ×™ ×™×›×•×œ ×œ×”×‘×™× ×œ×š?' ×”×“×’ ×”×§×˜×Ÿ ××’×™×‘ (××ª× ×©×) '××™×! ×× ×™ ×¦×¨×™×š ××™×!'",
            "×”××˜×¤×œ ×©×œ×™ ×××¨ ×œ×™ ×œ×©×™× ××§×•×•×¨×™×•× ×‘×¡×œ×•×Ÿ ×›×“×™ ×œ×”×§×œ ×¢×œ ××ª×— ×•×—×¨×“×”. ×”×•× ×××¨ ×©×–×” ×™×¢×–×•×¨ ×‘×’×œ×œ ×”×¡× ×¤×™×¨×™× ×”×¤× ×™××™×™× ×©×œ×”×.",
            "×“×’ × ×›× ×¡ ×œ×‘×¨. ×–×” ×œ×§×— ×œ×• 395 ××™×œ×™×•×Ÿ ×©× ×™×.", "×©××¢×ª ×¢×œ ×”×§×˜×˜×” ×‘×—× ×•×ª ×“×’×™× ×•×¦'×™×¤×¡? ×”×¨×‘×” ×“×’×™× ×›× ×¨××” ×”×•×›×•!",
            "××™×©×”×• ×–×¨×§ ×¢×œ×™×™ ×‘×§×‘×•×§ ×›×“×•×¨×™ ××•××’×” 3. ×œ××–×œ×™, ×¡×¤×’×ª×™ ×¨×§ ×¤×¦×™×¢×•×ª ×“×’ ×©××Ÿ ×¢×œ.",
            "×’×‘×¨ × ×›× ×¡ ×œ×××¤×™×™×” ×¢× ×¡×œ××•×Ÿ ××ª×—×ª ×œ×–×¨×•×¢ ×•××•××¨ '×™×© ×œ×š ×¢×•×’×•×ª ×“×’?' ×”×‘×—×•×¨ ×××—×•×¨×™ ×”×“×œ×¤×§ ×¢×•× ×”, '×œ×'. '×–×” ×—×‘×œ, ×–×” ×™×•× ×”×”×•×œ×“×” ×©×œ×•'.",
            "×™×© ×”×¨×‘×” ×“×’×™× ×‘×™×. ×”×¨×‘×” ×œ×•×•×™×™×ª× ×™× ×’×.", "××¢×•×œ× ×œ× ××›×œ×ª×™ ××¦×‘×¢×•×ª ×“×’. ×œ× ×™×“×¢×ª×™ ×©×œ×“×’×™× ×™×© ×™×“×™×™×.",
            "×”×ª×§×©×¨×ª×™ ×œ××™×©×” ×§×•×“× ×•×©××œ×ª×™ ×× ×”×™× ×¨×•×¦×” ×©××§×— ×“×’×™× ×•×¦'×™×¤×¡ ×‘×“×¨×š ×”×‘×™×ª×”, ××‘×œ ×”×™× ×¨×§ × ×”××” ×¢×œ×™×™. ×× ×™ ×—×•×©×‘ ×©×”×™× ×¢×“×™×™×Ÿ ××ª×—×¨×˜×ª ×©× ×ª× ×” ×œ×™ ×œ×§×¨×•× ×œ×ª××•××™×.",
            "×ª×Ÿ ×œ××“× ×“×’ ×•×”×•× ×™××›×œ ×œ×™×•×. ×œ××“ ××“× ×œ×“×•×’ ×•×”×•× ×™×‘×œ×” ××œ×¤×™ ×“×•×œ×¨×™× ×¢×œ ×¦×™×•×“ ×“×™×’.",
            "×©× ×™ ×“×’×™× ×‘×˜× ×§. ××—×“ ×¤×•× ×” ×œ×©× ×™ ×•××•××¨ '××ª×” ×™×•×“×¢ ××™×š ×œ× ×”×•×’ ×‘×“×‘×¨ ×”×–×”?'", "×—×™×™×ª ×”××—××“ ×©×œ×™ ×“×’ ×”×™× ×’×™×™××¨. ×”××©×—×§ ×”××”×•×‘ ×¢×œ×™×• ×”×•× ×§×•×“",
            "×©× ×™ ×’×‘×¨×™× ×™×•×¦××™× ×œ×“×•×’, ×œ××—×“ ×’××’×•×. ×”×’×‘×¨ ×¢× ×”×’××’×•× ××•××¨ '×©×© ×©×©×© ×©×©'. ×”×’×‘×¨ ×”×©× ×™ ××•××¨ '××” ×–×”, ×ª×¤×¡×ª ×“×’?' ×”×©×•××¨ ×¤×•×ª×— ××ª ×§×™×¨×•×¨ ×”×“×™×™×’×™× ×•×¨×•××” ×©×”×‘×—×•×¨ ×—×¨×’ ××”××’×‘×œ×” ×©×œ×• ×‘×›-20 ×“×’×™×. ×”×©×•××¨ ××•××¨ ×œ×’×‘×¨ ×©×™×© ×œ×• ×™×•×ª×¨ ××“×™ ×“×’×™× ×•×”×•× ×™×§× ×¡ ××•×ª×•. ×”×“×™×™×’ ××•××¨ '×œ×, ××ª×” ×¨×•××” ××œ×” ×—×™×•×ª ×”××—××“ ×©×œ×™. ×œ× ×ª×¤×¡×ª×™ ××•×ª× ×§×¨××ª×™ ×œ×”× ××œ×™×™'. ×”×©×•××¨ ×œ× ××××™×Ÿ ×œ×‘×—×•×¨, ××– ×”×“×™×™×’ ××•××¨ ×œ×©×•××¨ ×©×”×•× ×™×¨××” ×œ×•. ×”×‘×—×•×¨ ×©×•×¤×š ××ª ×”×§×™×¨×•×¨ ×©×œ ×“×’×™× ×œ××™×. ×”×©×•××¨ ××—×›×” ×“×§×” ×•××•××¨ ×œ×‘×—×•×¨ '×˜×•×‘ ×¢×›×©×™×• ×§×¨× ×œ×“×’×™× ×‘×—×–×¨×”'. ×”×’×‘×¨ ×”×¡×ª×›×œ ×¢×œ ×”×©×•××¨ ×•×××¨: '××™×œ×• ×“×’×™×?'",
            "××ª××•×œ ×¢×©×™×ª×™ ×˜××§×•×¡ ×“×’×™×. ×”× ×”×¡×ª×›×œ×• ×¢×œ×™×”× ×•×¤×©×•×˜ ×©×—×• ××©×.",
            "×§× ×™×ª×™ ×œ××”×‘×ª ×—×™×™ ×›××” ×“×’×™× ××•×•×©×™× ×’×˜×•×Ÿ, ××‘×œ ×”×™× ×–×¨×§×” ××•×ª×™ ××™×“ ××—×¨ ×›×š. × ×•, ×™×© ×”×¨×‘×” ×™×•×ª×¨ ×“×’×™× ×‘-DC.",
            "××” ××ª×” × ×•×ª×Ÿ ×œ×“×’ ×‘×™×•× ×”×”×•×œ×“×ª ×©×œ×•? ×¢×•×’×ª ×“×’.",
            "×‘×—×•×¨ ×”×™×” ×¢×œ ×”×¡×™×¨×” ×©×œ×• ×“×•×’ ×‘×‘×¨×™×›×” ×•×ª×¤×¡ ×”×¨×‘×” ××¢×‘×¨ ×œ××’×‘×œ×ª ×”×©×§. ×”×•× ×—×•×–×¨ ×œ×¨×¦×™×£ ×›×©×”×©×•××¨ ×¢×•×¦×¨ ××•×ª×• ×•××‘×§×© ×œ×‘×“×•×§ ××” ×”×•× ×ª×¤×¡. ×”×©×•××¨ ×¤×•×ª×— ××ª ×§×™×¨×•×¨ ×”×“×™×™×’×™× ×•×¨×•××” ×©×”×‘×—×•×¨ ×—×¨×’ ××”××’×‘×œ×” ×©×œ×• ×‘×›-20 ×“×’×™×. ×”×©×•××¨ ××•××¨ ×œ×’×‘×¨ ×©×™×© ×œ×• ×™×•×ª×¨ ××“×™ ×“×’×™× ×•×”×•× ×™×§× ×¡ ××•×ª×•. ×”×“×™×™×’ ××•××¨ '×œ×, ××ª×” ×¨×•××” ××œ×” ×—×™×•×ª ×”××—××“ ×©×œ×™. ×œ× ×ª×¤×¡×ª×™ ××•×ª× ×§×¨××ª×™ ×œ×”× ××œ×™×™'. ×”×©×•××¨ ×œ× ××××™×Ÿ ×œ×‘×—×•×¨, ××– ×”×“×™×™×’ ××•××¨ ×œ×©×•××¨ ×©×”×•× ×™×¨××” ×œ×•. ×”×‘×—×•×¨ ×©×•×¤×š ××ª ×”×§×™×¨×•×¨ ×©×œ ×“×’×™× ×œ××™×. ×”×©×•××¨ ××—×›×” ×“×§×” ×•××•××¨ ×œ×‘×—×•×¨ '×˜×•×‘ ×¢×›×©×™×• ×§×¨× ×œ×“×’×™× ×‘×—×–×¨×”'. ×”×’×‘×¨ ×”×¡×ª×›×œ ×¢×œ ×”×©×•××¨ ×•×××¨: '××™×œ×• ×“×’×™×?'",
            "××™×Ÿ ×©×•× ×“×’ ××ª×—×ª ×œ×§×¨×—!", "×”××•×¨×” ×”××¨×©×¢×ª ×‘×›×™×ª×” ×”×™× ×“×’ ×›×™ ×”×™× ×ª××™×“ ×¦×•×¢×§×ª '×©×©×©×©×©×©'",
            "×™×©×¨××œ×™ ××—×“ ×”×•×œ×š ×œ××¢×“× ×™×™×” ×‘× ×™×• ×™×•×¨×§ ×•××•××¨ ×œ××•×›×¨: '×ª×Ÿ ×œ×™ ×§\"×’ ××”×“×’ ×”×–×”.' '××‘×œ ××“×•× ×™ ×–×” ×œ× ×“×’, ×–×” ×—×–×™×¨' ×¢×•× ×” ×”××•×›×¨. '×× ×™ ×œ× ×©××œ×ª×™ ××•×ª×š ××™×š ×§×•×¨××™× ×œ×“×’ ×”×–×”!'."
        ];
        
        let fishQuotes = [...ORIGINAL_JOKES]; // ×”××¢×¨×š ×”×“×™× ××™ ×”× ×•×›×—×™
        
        // ×¤×•× ×§×¦×™×” ×œ×§×‘×™×¢×ª ××©×š ×”×¦×’×ª ×”×‘×•×¢×”
        function getBubbleDuration(text) {
            const BASE_DURATION = 10000; // 10 ×©× ×™×•×ª ×‘×¡×™×¡
            const MIN_DURATION = 5000;  // 5 ×©× ×™×•×ª ××™× ×™××•×
            
            if (text.length < 20) {
                return MIN_DURATION;
            }
            return BASE_DURATION;
        }

        // --- ×¤×•× ×§×¦×™×” ×œ×˜×¢×™× ×ª ×“×’× ×”×“×’ (GLB) ×¢× ×¤×•×œ×‘×§ ---
        function createFish() {
            return new Promise((resolve) => {
                const loader = new THREE.GLTFLoader();
                loader.load('https://raw.githubusercontent.com/orengamchi/3d_models_collection/main/clown_fish.glb', (gltf) => {
                    const fish = gltf.scene;
                    fish.scale.set(0.05, 0.05, 0.05); 
                    fish.castShadow = true;
                    fish.traverse((child) => {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                            if (child.material) {
                                child.material.envMapIntensity = 4.0;
                            }
                        }
                    });

                    let mixer = null;
                    if (gltf.animations && gltf.animations.length > 0) {
                        mixer = new THREE.AnimationMixer(fish);
                        gltf.animations.forEach((clip) => {
                            mixer.clipAction(clip).play();
                        });
                    }

                    resolve({ fish, mixer });
                }, undefined, (error) => {
                    console.error('Error loading GLB model. Using fallback:', error);
                    const fishGroup = new THREE.Group();
                    const bodyGeometry = new THREE.SphereGeometry(1.5, 32, 32, 0, Math.PI * 2, 0, Math.PI);
                    bodyGeometry.scale(1.0, 0.7, 0.5);
                    
                    const fishTexture = new THREE.TextureLoader().load('https://i.imgur.com/Z7y9k5r.jpg');
                    const bodyMaterial = new THREE.MeshPhysicalMaterial({
                        map: fishTexture,
                        roughness: 0.7,
                        metalness: 0.3,
                        transparent: true,
                        opacity: 0.9,
                        transmission: 0.2,
                        ior: 1.5,
                        side: THREE.DoubleSide,
                        envMapIntensity: 4.0
                    });
                    const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
                    body.castShadow = true;
                    fishGroup.add(body);
                    fishGroup.scale.set(0.05, 0.05, 0.05); 
                    resolve({ fish: fishGroup, mixer: null });
                });
            });
        }

        // --- ×™×¦×™×¨×ª ×•×”×¦×‘×ª ×”×“×’×™× ---
        async function initializeFishes() {
            for (let i = 0; i < 10; i++) {
                const { fish, mixer } = await createFish();
                fish.position.set(
                    Math.random() * 20 - 10,
                    Math.random() * 18 - 8,
                    Math.random() * 20 - 10
                );
                fish.rotation.y = Math.random() * Math.PI * 2;
                scene.add(fish);
                
                const bubble = document.createElement('div');
                bubble.className = 'speech-bubble';
                bubble.style.display = 'none';
                document.body.appendChild(bubble);

                const anchorBubble = document.createElement('div');
                anchorBubble.className = 'anchor-icon-bubble';
                document.body.appendChild(anchorBubble);
                
                fishes.push({
                    mesh: fish,
                    velocity: new THREE.Vector3(
                        (Math.random() - 0.5) * 0.05,
                        (Math.random() - 0.5) * 0.01,
                        (Math.random() - 0.5) * 0.05
                    ),
                    bubble: bubble,
                    anchorBubble: anchorBubble, 
                    bubbleTimer: Math.random() * 5,
                    directionChangeTimer: Math.random() * 5 + 5,
                    responseTimer: -1,
                    mixer: mixer,
                    assignedAnchor: ANCHOR_GROUPS[currentAnchorType][i % ANCHOR_GROUPS[currentAnchorType].length],
                    isFrozenVisible: false 
                });
            }
        }

        // --- ×‘×•×¢×•×ª ××•×•×™×¨ ×¢×•×œ×•×ª ---
        const bubbleGeometry = new THREE.SphereGeometry(0.1, 16, 16);
        const bubbleMaterial = new THREE.MeshPhysicalMaterial({
            color: 0xffffff,
            transparent: true,
            opacity: 0.7,
            roughness: 0.1,
            metalness: 0.0,
            transmission: 1.0,
            ior: 1.01,
            emissive: 0xffffff,
            emissiveIntensity: 0.2
        });
        const bubbles = [];
        for (let i = 0; i < 50; i++) {
            const bubble = new THREE.Mesh(bubbleGeometry, bubbleMaterial);
            bubble.position.set(
                Math.random() * 20 - 10,
                -10,
                Math.random() * 20 - 10
            );
            scene.add(bubble);
            bubbles.push({
                mesh: bubble,
                velocity: new THREE.Vector3(
                    (Math.random() - 0.5) * 0.005,
                    Math.random() * 0.05 + 0.02,
                    (Math.random() - 0.5) * 0.005
                )
            });
        }

        // --- ×”×’×“×¨×•×ª API ××•×¨×—×‘×•×ª ---
        const API_PROMPTS = {
            news: {
                query: "×›×•×ª×¨×•×ª ×—×“×©×•×ª ××§×˜×•××œ×™×•×ª ××™×©×¨××œ ×•××”×¢×•×œ×, ×›×•×œ×œ ××§×•×¨ ×›××• ynet, ×—×“×©×•×ª 12 ×•×›×“×•××”",
                system: "Act as a concise news aggregator. Generate a list of 10 current news headlines in Hebrew based on the latest available information. For each headline, include a concise source (e.g., 'ynet', '×—×“×©×•×ª 12') and a time reference (e.g., '×œ×¤× ×™ 3 ×©×¢×•×ª'). Include a channel icon emoji at the start of each line, such as ğŸ“º, ğŸ“°, ğŸ“. Output the headline, source, and time on a single line. Do not add any introductory text, concluding remarks, numbering, or bullet points. Example line: ğŸ“º ×›×•×ª×¨×ª ×”×“×™×•×•×— (××§×•×¨, ×–××Ÿ ×¤×¨×¡×•×).",
                message: "×›×•×ª×¨×•×ª ×—×“×©×•×ª",
                anchorGroup: 'general'
            },
            i24news: { 
                query: "×“×™×•×•×—×™× ×‘×™× ×œ××•××™×™× ×¢×“×›× ×™×™× ×‘×¢×œ×™ ×–×™×§×” ×œ×™×©×¨××œ",
                system: "Act as a global news anchor for I24NEWS. Provide 8 concise, relevant international headlines focusing on diplomacy, security, and global events relevant to Israel. Start each line with the ğŸŒ emoji. Include a global source (e.g., '×¨×•×™×˜×¨×¡', 'CNN') and a time reference (e.g., '×œ×¤× ×™ 2 ×“×§×•×ª'). Output on a single line. Do not add any introductory text, concluding remarks, numbering, or bullet points.",
                message: "×¢×“×›×•× ×™ I24 NEWS",
                anchorGroup: 'i24news'
            },
            tech: { 
                query: "×—×“×©×•×ª ×”×™-×˜×§ ×•×¡×™×™×‘×¨ ××§×˜×•××œ×™×•×ª ××™×©×¨××œ ×•×”×¢×•×œ×",
                system: "Act as a cyber and tech news terminal. Generate 8 recent headlines in Hebrew on cybersecurity, startups, and advanced technology. The tone must be concise and sharp, using technical or 'cyber' jargon where appropriate. For each headline, include a key technological term or company name. Output on a single line. Do not add any introductory text, concluding remarks, numbering, or bullet points.",
                message: "×¢×“×›×•× ×™ ×¡×™×™×‘×¨ ×•×”×™-×˜×§",
                anchorGroup: 'tech'
            },
            sport: { 
                query: "×ª×•×¦××•×ª ×•×¢×“×›×•× ×™× ××—×¨×•× ×™× ×‘×›×“×•×¨×’×œ, ×›×“×•×¨×¡×œ ×•×¡×¤×•×¨×˜ ×™×©×¨××œ×™ ×•×‘×™× ×œ××•××™",
                system: "Act as a sportscaster. Provide 8 exciting and recent updates on Israeli and international football and basketball results. Start each line with a relevant sports emoji (e.g., âš½, ğŸ€, ğŸ¥‡, ğŸ†). Include team names and scores/results. Output on a single line. Do not add any introductory text, concluding remarks, numbering, or bullet points.",
                message: "×¢×“×›×•× ×™ ×¡×¤×•×¨×˜",
                anchorGroup: 'sport'
            },
            stock: {
                query: "×©×¢×¨×™ ××“×“ ×ª×œ ××‘×™×‘ 125, ×”×“×•×œ×¨, ×•×”×™×•×¨×•, ×•×¢×“×›×•×Ÿ ×§×¦×¨ ×¢×œ ××¦×‘ ×”××¡×—×¨",
                system: "Act as a financial news ticker. Provide 7 distinct, concise updates in Hebrew regarding the Tel Aviv 125 stock index (TA-125), the exchange rates for the US Dollar (USD) and the Euro (EUR), and a brief summary of market sentiment. Include numerical changes and use specific Unicode arrow icons (â–² for gain, â–¼ for loss) to visually represent movement/trend for each item, simulating a diagram. Example line: ×ª\"× 125: 1,800.56 (â–² 1.25%).",
                message: "× ×ª×•× ×™ ×‘×•×¨×¡×”",
                anchorGroup: 'finance'
            },
            weather: {
                query: "×ª×—×–×™×ª ××–×’ ××•×•×™×¨ ×™×•××™×ª ×¢×“×›× ×™×ª ×‘×™×©×¨××œ (×™×¨×•×©×œ×™×, ×ª×œ ××‘×™×‘, ×—×™×¤×”, ×‘××¨ ×©×‘×¢) ×¢× ×“×’×© ×¢×œ ×˜××¤×¨×˜×•×¨×•×ª",
                system: "Act as a visual meteorologist. Provide a short, one-sentence weather summary for today in Israel, followed by current temperature or forecast high temperatures for Jerusalem, Tel Aviv, Haifa, and Be'er Sheva. Use Hebrew and include a highly relevant weather emoji icon (e.g., â˜€ï¸, ğŸŒ§ï¸, â˜ï¸) at the start of each line. Output each piece of information on a new line. Do not add any introductory text, concluding remarks, numbering, or bullet points.",
                message: "××–×’ ××•×•×™×¨",
                anchorGroup: 'weather'
            },
            jokes: { 
                query: "×‘×“×™×—×•×ª ×“×’×™× ×§×¦×¨×•×ª ×‘×¢×‘×¨×™×ª",
                system: "Generate 10 short, funny fish jokes in Hebrew. Each joke should be on a new line. Do not add any introductory or concluding text, numbering, or bullet points.",
                message: "×‘×“×™×—×•×ª ×“×’×™× ×§×œ××¡×™×•×ª",
                anchorGroup: 'general'
            }
        };

        // ** ×¤×•× ×§×¦×™×” ×—×“×©×”: ×”×’×“×¨×ª ××¤×ª×— ×”-API **
        function setApiKey(hideModal) {
            const input = document.getElementById('apiKeyInput');
            const newKey = input.value.trim();
            if (newKey) {
                API_KEY = newKey;
                STATUS_MESSAGE.innerText = "××¤×ª×— API × ×©××¨ ×‘×”×¦×œ×—×”. × ×™×ª×Ÿ ×œ×¢×“×›×Ÿ × ×ª×•× ×™×!";
                enableDataButtons(true);
            } else {
                API_KEY = "";
                STATUS_MESSAGE.innerText = "×× × ×”×›× ×¡ ××¤×ª×— API ×—×•×§×™ ×›×“×™ ×œ××¤×©×¨ ×§×¨×™××•×ª × ×ª×•× ×™×.";
                enableDataButtons(false);
            }

            if (hideModal) {
                document.getElementById('api-modal').style.display = 'none';
            }
        }
        
        // ** ×¤×•× ×§×¦×™×” ×—×“×©×”: ×”×¤×¢×œ×ª/×”×©×‘×ª×ª ×›×¤×ª×•×¨×™× **
        function enableDataButtons(enabled) {
            document.querySelectorAll('.data-button').forEach(btn => {
                // ×¨×§ ×›×¤×ª×•×¨ ×”×‘×“×™×—×•×ª × ×©××¨ ×¤×¢×™×œ ×ª××™×“
                if (btn.id !== 'jokesButton') {
                    btn.disabled = !enabled;
                }
            });
        }
        
        async function fetchQuotes(type) {
            if (!API_KEY && type !== 'jokes') {
                STATUS_MESSAGE.innerText = "×©×’×™××”: ×™×© ×œ×”×›× ×™×¡ ××¤×ª×— API ×œ×¤× ×™ ×§×¨×™××ª × ×ª×•× ×™× ×‘×–××Ÿ ×××ª.";
                showApiModal(); // ** ×©×™× ×•×™: ×¤×ª×— ××ª ×”××•×“××œ ×× ×—×¡×¨ ××¤×ª×— **
                return;
            }
            
            const promptConfig = API_PROMPTS[type];
            currentAnchorType = promptConfig.anchorGroup; 
            
            
            // ×”×©×‘×ª×ª ×›×œ ×”×›×¤×ª×•×¨×™× ×œ×× ×™×¢×ª ×§×¨×™××•×ª ×›×¤×•×œ×•×ª
            document.querySelectorAll('.data-button').forEach(btn => btn.disabled = true);
            STATUS_MESSAGE.innerText = `×˜×•×¢×Ÿ ${promptConfig.message} (×–×” ×¢×©×•×™ ×œ×§×—×ª ×›××” ×©× ×™×•×ª)...`;

            // ** (×ª×™×§×•×Ÿ) ×”×’×“×¨×ª Payload ×‘×¡×™×¡×™ **
            const payload = {
                contents: [{ parts: [{ text: promptConfig.query }] }],
                systemInstruction: {
                    parts: [{ text: promptConfig.system }]
                },
            };

            // ** (×ª×™×§×•×Ÿ) ×”×•×¡×£ ×›×œ×™× ×¨×§ ×× ×–×” *×œ×* ×‘×“×™×—×•×ª **
            if (type !== 'jokes') {
                payload.tools = [{ "google_search": {} }];
            }

            let attempts = 0;
            const maxAttempts = 3;
            let success = false;
            let newQuotes = [];

            while (attempts < maxAttempts && !success) {
                attempts++;
                try {
                    // ** ×©×™××•×© ×‘××¤×ª×— ×”-API ×”×’×œ×•×‘×œ×™ **
                    const apiUrlWithKey = API_URL + API_KEY; 
                    
                    const response = await fetch(apiUrlWithKey, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    // (×ª×™×§×•×Ÿ) ×˜×™×¤×•×œ ×©×•× ×” ×‘×©×’×™××•×ª
                    if (!response.ok) {
                         const errorBody = await response.json(); // × ×¡×” ×œ×§×¨×•× ××ª ×’×•×£ ×”×©×’×™××”
                         console.error("API Error Body:", errorBody);
                         if (response.status === 400) {
                             STATUS_MESSAGE.innerText = `×©×’×™××ª 400 (Bad Request). ×•×“× ×©××¤×ª×— ×”-API ×©×œ×š ×—×•×§×™ ×•×—×©×‘×•×Ÿ ×”×—×™×•×‘ ×¤×¢×™×œ.`;
                         } else {
                             throw new Error(`HTTP error! status: ${response.status}`);
                         }
                         continue; // ×“×œ×’ ×œ×”××©×š ×”×œ×•×œ××”
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text || '';
                    
                    if (text) {
                        newQuotes = text.split('\n')
                                        .map(line => line.trim())
                                        .filter(line => line.length > 5);
                        success = true;
                    }
                } catch (error) {
                    console.error("Error fetching data:", error);
                    if (attempts < maxAttempts) {
                        STATUS_MESSAGE.innerText = `× ×™×¡×™×•×Ÿ ×˜×¢×™× ×” ${attempts} × ×›×©×œ... ×× ×¡×” ×©×•×‘.`;
                        const delay = Math.pow(2, attempts) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                }
            }
            
            enableDataButtons(true); // ×”×¤×¢×œ ×›×¤×ª×•×¨×™× ××—×“×© ×œ××—×¨ ×¡×™×•× ×”×§×¨×™××”

            if (newQuotes.length > 0) {
                fishQuotes = newQuotes;
                STATUS_MESSAGE.innerText = `×”×“×’×™× ××¦×™×’×™× ${promptConfig.message} (${fishQuotes.length} ×¤×¨×™×˜×™×)`;
            } else {
                fishQuotes = [...ORIGINAL_JOKES];
                // ×× ×”×©×’×™××” ×œ× ×”×™×™×ª×” 400 ××œ× ×›×©×œ ×›×œ×œ×™, ×”×¦×’ ×”×•×“×¢×” ××—×¨×ª
                if (!STATUS_MESSAGE.innerText.includes("400")) {
                    STATUS_MESSAGE.innerText = `×©×’×™××ª ×¢×“×›×•×Ÿ: ×œ× × ×™×ª×Ÿ ×”×™×” ×œ×˜×¢×•×Ÿ ${promptConfig.message}. ×—×–×¨× ×• ×œ×‘×“×™×—×•×ª.`;
                }
                currentAnchorType = 'general'; // ×—×–×¨×” ×œ×§×‘×•×¦×ª ×”××’×™×©×™× ×”×›×œ×œ×™×ª
            }
        }
        
        // ×¤×•× ×§×¦×™×” ×›×œ×œ×™×ª ×œ×¢×“×›×•×Ÿ ×ª×•×›×Ÿ (×›×¤×ª×•×¨ ×—×“×©×•×ª, ××–×’ ××•×•×™×¨, ×‘×•×¨×¡×”)
        function updateQuotes(type) {
            fetchQuotes(type);
        }
        
        // ×¤×•× ×§×¦×™×” ×œ×—×–×¨×” ×œ××¢×¨×š ×”×‘×“×™×—×•×ª ×”××§×•×¨×™×•×ª
        function returnToJokes() {
            fishQuotes = [...ORIGINAL_JOKES];
            STATUS_MESSAGE.innerText = '×—×–×¨× ×• ×œ×‘×“×™×—×•×ª ×“×’×™× ×§×œ××¡×™×•×ª!';
            currentAnchorType = 'general'; // ×—×–×¨×” ×œ×§×‘×•×¦×ª ×”××’×™×©×™× ×”×›×œ×œ×™×ª
        }

        // ** ×¤×•× ×§×¦×™×” ×—×“×©×”: ×”×§×¤××”/×”××©×š **
        function togglePause() {
            isPaused = !isPaused;
            const button = document.getElementById('pauseButton');
            button.innerHTML = isPaused ? "â–¶ï¸" : "â¸ï¸"; // ×©×™× ×•×™ ××™×§×•×Ÿ
            button.title = isPaused ? "×”××©×š" : "×”×§×¤××”";

            if (isPaused) {
                // ×©××•×¨ ××ª ××¦×‘ ×”×‘×•×¢×•×ª ×›×¤×™ ×©×”×•×
                fishes.forEach(fish => {
                    if (fish.bubble.style.display === 'block') {
                        fish.isFrozenVisible = true;
                    } else {
                        fish.isFrozenVisible = false;
                    }
                });
                STATUS_MESSAGE.innerText = "×”××§×•×•×¨×™×•× ×•×”××™×“×¢ ××•×§×¤××™×. ×ª× ×•×¢×ª ×”××¦×œ××” ×¢×“×™×™×Ÿ ×¤×¢×™×œ×”.";
            } else {
                // ××¤×¡ ××ª ×”×‘×•×¢×•×ª ×›×“×™ ×©×”×Ÿ ×™×ª×—×™×œ×• ××—×“×© ×›×¨×’×™×œ
                fishes.forEach(fish => {
                    fish.isFrozenVisible = false;
                    fish.bubble.style.display = 'none';
                    fish.anchorBubble.style.display = 'none';
                    fish.bubbleTimer = Math.random() * 5; // ××¤×¡ ×˜×™×™××¨ ×“×™×‘×•×¨
                });

                STATUS_MESSAGE.innerText = "×”××§×•×•×¨×™×•× ×—×–×¨ ×œ×¤×¢×™×œ×•×ª ××œ××”.";
            }
        }
        
        // ** ×¤×•× ×§×¦×™×” ×—×“×©×”: ×”×¦×’×ª ××•×“××œ API **
        function showApiModal() {
             document.getElementById('api-modal').style.display = 'flex';
             document.getElementById('apiKeyInput').focus();
        }

        // ** ×¤×•× ×§×¦×™×” ×—×“×©×”: ×”×¦×’×ª ××•×“××œ ××™×“×¢ **
        function showInfoModal() {
             document.getElementById('info-modal').style.display = 'flex';
        }
        
        function hideInfoModal() {
             document.getElementById('info-modal').style.display = 'none';
        }

        // --- (×—×“×©) ×œ×•×’×™×§×ª ×”×¡×ª×¨×ª UI ×•×”××‘×•×¨×’×¨ ---
        let uiTimeout;
        const uiContainer = document.getElementById('ui-container');

        function hideUI() {
            uiContainer.classList.add('hidden');
        }

        function showUI() {
            clearTimeout(uiTimeout);
            uiContainer.classList.remove('hidden');
            uiTimeout = setTimeout(hideUI, 5000); // ×”×¤×¢×œ ×˜×™×™××¨ ×”×¡×ª×¨×” ×—×“×©
        }
        
        // --- (×—×“×©) ×¤×•× ×§×¦×™×” ×œ×”×ª×××ª FOV ×‘×©×™× ×•×™ ×’×•×“×œ ---
        function handleResize() {
            const width = window.innerWidth;
            const height = window.innerHeight;

            camera.aspect = width / height;

            // (×”×œ×•×’×™×§×” ×©×œ ×©×™× ×•×™ FOV ×œ××•×‘×™×™×œ ×”×•×¡×¨×” ×œ×‘×§×©×ª ×”××©×ª××© ×œ××—×“ ×—×•×•×™×”)
            camera.fov = 75; 

            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
            backgroundMaterial.uniforms.u_resolution.value.set(width, height);
        }

        // ×˜×™×¤×•×œ ×‘×©×™× ×•×™ ×’×•×“×œ ×”×—×œ×•×Ÿ
        window.addEventListener('resize', handleResize);
        
        // --- (×—×“×©) ×”×¤×¢×œ×ª ×××–×™× ×™× ---
        
        // ×××–×™× ×™× ×œ×ª× ×•×¢×ª ×¢×›×‘×¨
        window.addEventListener('mousemove', showUI);
        
        // --- (×ª×™×§×•×Ÿ) ×©×—×–×•×¨ ×¤×•× ×§×¦×™×™×ª ×”×× ×™××¦×™×” ---
        const clock = new THREE.Clock(); // ×”×’×“×¨×” ×’×œ×•×‘×œ×™×ª ×™×—×™×“×”

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();
            const elapsedTime = clock.getElapsedTime(); 
            
            // ×¢×“×›×•×Ÿ ×¨×–×•×œ×•×¦×™×” ×•×–××Ÿ ×œ×©×™×™×“×¨ ×”×¨×§×¢
            if (backgroundMaterial) {
                backgroundMaterial.uniforms.u_time.value = elapsedTime;
                backgroundMaterial.uniforms.u_resolution.value.set(window.innerWidth, window.innerHeight);
            }

            // ×‘×§×¨×ª ××¦×œ××” (××ª×¢×“×›×Ÿ ×ª××™×“)
            controls.update();
            
            if (fishes.length === 0) {
                 renderer.render(scene, camera);
                 return; // ××œ ×ª××©×™×š ×× ×”×“×’×™× ×¢×•×“ ×œ× × ×˜×¢× ×•
            }

            // ×¢×“×›×•×Ÿ ×‘×•×¢×•×ª ××•×•×™×¨ (×× ×œ× ××•×§×¤×)
            if (!isPaused) {
                bubbles.forEach(bubble => {
                    bubble.mesh.position.add(bubble.velocity);
                    
                    if (bubble.mesh.position.y > 10) {
                        bubble.mesh.position.y = -10;
                        bubble.mesh.position.x = Math.random() * 20 - 10;
                        bubble.mesh.position.z = Math.random() * 20 - 10;
                        bubble.velocity.y = Math.random() * 0.05 + 0.02;
                    }
                });
            }

            // ** 2. ×¢×“×›×•×Ÿ ×“×’×™× **
            fishes.forEach((fish, index) => {
                
                // ×¢×“×›×Ÿ ×× ×™××¦×™×™×ª ×¡× ×¤×™×¨×™× (×ª××™×“ ×¤×•×¢×œ, ×’× ×‘×”×§×¤××”)
                if (fish.mixer) {
                    fish.mixer.update(delta);
                }

                if (!isPaused) {
                    const pos = fish.mesh.position;
                    pos.add(fish.velocity);

                    const bounds = 15;
                    const heightBound = 10;

                    if (pos.x >= bounds - 0.1 || pos.x <= -bounds + 0.1) fish.velocity.x *= -1;
                    if (pos.y >= heightBound - 0.1 || pos.y <= -heightBound + 0.1) fish.velocity.y *= -1;
                    if (pos.z >= bounds - 0.1 || pos.z <= -bounds + 0.1) fish.velocity.z *= -1;

                    pos.x = Math.max(-bounds + 0.1, Math.min(bounds - 0.1, pos.x));
                    pos.y = Math.max(-heightBound + 0.1, Math.min(heightBound - 0.1, pos.y));
                    pos.z = Math.max(-bounds + 0.1, Math.min(bounds - 0.1, pos.z));

                    fish.directionChangeTimer -= delta;
                    if (fish.directionChangeTimer <= 0) {
                        fish.velocity.set(
                            (Math.random() - 0.5) * 0.05,
                            (Math.random() - 0.5) * 0.01,
                            (Math.random() - 0.5) * 0.05
                        ).normalize().multiplyScalar(0.05);
                        fish.directionChangeTimer = Math.random() * 5 + 5;
                    }

                    const targetRotation = Math.atan2(fish.velocity.x, fish.velocity.z);
                    fish.mesh.rotation.y += (targetRotation - fish.mesh.rotation.y) * 0.05;

                    // ×œ×•×’×™×§×ª ×‘×•×¢×ª ×”×“×™×‘×•×¨
                    fish.bubbleTimer += delta;
                    
                    // ×¢×“×›×•×Ÿ ×”××’×™×© ×œ×“×’
                    const anchorData = ANCHOR_GROUPS[currentAnchorType][index % ANCHOR_GROUPS[currentAnchorType].length];
                    fish.anchorBubble.innerHTML = `${anchorData.icon} ${anchorData.name}`;

                    // ×× ×œ× ××•×§×¤× ×•×”×’×™×¢ ×”×–××Ÿ ×œ×“×‘×¨
                    if (fish.bubbleTimer > 5 && fish.responseTimer < 0) {
                        if(fishQuotes.length === 0) return; 

                        const quote = fishQuotes[Math.floor(Math.random() * fishQuotes.length)];
                        const duration = getBubbleDuration(quote); 
                        
                        fish.bubbleTimer = Math.random() * -5;
                        fish.bubble.innerText = quote;
                        fish.bubble.style.display = 'block';
                        fish.anchorBubble.style.display = 'block';
                        fish.isFrozenVisible = true; // ×¡××Ÿ ×›×’×œ×•×™
                        
                        setTimeout(() => {
                            if (!isPaused) { 
                                fish.bubble.style.display = 'none';
                                fish.anchorBubble.style.display = 'none';
                                fish.isFrozenVisible = false;
                            }
                        }, duration); 
                                            
                        let closestFish = null;
                        let minDist = Infinity;
                        fishes.forEach((otherFish, otherIndex) => {
                            if (otherIndex !== index && otherFish.responseTimer < 0) {
                                const dist = pos.distanceTo(otherFish.mesh.position);
                                if (dist < minDist) {
                                    minDist = dist;
                                    closestFish = otherFish;
                                }
                            }
                        });
                        if (closestFish && minDist < 10 && Math.random() > 0.6) {
                            closestFish.responseTimer = Math.random() * 1 + 1.5;
                        }
                    }

                    // ×œ×•×’×™×§×ª ×ª×’×•×‘×” ×œ×“×™×‘×•×¨
                    if (fish.responseTimer > 0) {
                        fish.responseTimer -= delta;
                        if (fish.responseTimer <= 0) {
                            if(fishQuotes.length === 0) return;

                            const quote = fishQuotes[Math.floor(Math.random() * fishQuotes.length)];
                            const duration = getBubbleDuration(quote); 

                            fish.bubble.innerText = quote;
                            fish.bubble.style.display = 'block';
                            fish.anchorBubble.style.display = 'block';
                            fish.isFrozenVisible = true;
                            
                            setTimeout(() => {
                                if (!isPaused) { 
                                    fish.bubble.style.display = 'none';
                                    fish.anchorBubble.style.display = 'none';
                                    fish.isFrozenVisible = false;
                                }
                            }, duration); 
                            fish.responseTimer = -1;
                        }
                    }
                } // ×¡×•×£ if (!isPaused)

                // ** ××™×§×•× ×‘×•×¢×•×ª ×”-HTML (××ª×¢×“×›×Ÿ ×ª××™×“, ×’× ×‘×”×§×¤××”, ×›×“×™ ×©×™×™×©××¨×• ×¦××•×“×•×ª ×œ×“×’×™×) **
                if (isPaused) {
                    if (fish.isFrozenVisible) {
                        fish.bubble.style.display = 'block';
                        fish.anchorBubble.style.display = 'block';
                    } else {
                        fish.bubble.style.display = 'none';
                        fish.anchorBubble.style.display = 'none';
                    }
                }
                
                // ×‘×¦×¢ ×—×™×©×•×‘ ××™×§×•× ×¨×§ ×× ×”×‘×•×¢×” ×’×œ×•×™×”
                if (fish.bubble.style.display === 'block') {
                    const vector = new THREE.Vector3();
                    fish.mesh.getWorldPosition(vector);
                    
                    vector.project(camera); 
                    
                    const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                    const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;
                    
                    
                    // --- (×ª×™×§×•×Ÿ ×¡×•×¤×™) ×œ×•×’×™×§×ª ××™×§×•× ×‘×•×¢×•×ª ×œ×× ×™×¢×ª ×—×¤×™×¤×” ---

                    // 1. ×§×•×“× ×›×œ, ××§× ××ª ×‘×•×¢×ª ×”×˜×§×¡×˜ ×”×¨××©×™×ª (z-index 10)
                    fish.bubble.style.left = `${x}px`;
                    fish.bubble.style.top = `${y}px`; // ×”×ª×—×ª×™×ª ×©×œ×” ×‘-Y

                    // 2. ×§×¨× ××ª ×”×’×•×‘×” ×©×œ ×‘×•×¢×ª ×”×˜×§×¡×˜ (×›××” ×”×™× ×ª×•×¤×¡×ª ×œ××¢×œ×”)
                    const textBubbleHeight = fish.bubble.offsetHeight;
                    
                    // 3. ××§× ××ª ×‘×•×¢×ª ×”××’×™×© (z-index 12) ××¢×œ ×‘×•×¢×ª ×”×˜×§×¡×˜
                    const anchorY = y - textBubbleHeight - 10; // 10px ×¨×•×•×—

                    fish.anchorBubble.style.left = `${x}px`;
                    fish.anchorBubble.style.top = `${anchorY}px`;
                }
            });
            
            renderer.render(scene, camera);
        }

        // ×”×¤×¢×œ×ª ×œ×•×œ××ª ×”×× ×™××¦×™×” ×¢× ×˜×¢×™× ×ª ×”×—×œ×•×Ÿ
        window.onload = function () {
            initializeFishes(); 
            handleResize(); // ** ×§×¨× ×œ-handleResize ×‘×˜×¢×™× ×” ×¨××©×•× ×™×ª **
            animate();
            
            // ×”×’×“×¨×” ×¨××©×•× ×™×ª ××—×™×“×” (×›××• ×‘××—×©×‘)
            setTimeout(hideUI, 5000); 
            
            // ×‘×“×•×§ ×× ×™×© ××¤×ª×— API ×××ª×—×•×œ (×× ×”×™×” × ×©××¨)
            setApiKey(false);
        }
    </script>
</body>
</html>